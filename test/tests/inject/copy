. functions

tst() {
  {
    echo "To: bruceg@em.ca"
    echo
    dd if=/dev/urandom bs=1k count=$1 2>/dev/null | uuencode data
  } >testmessage.in
  inject -n <testmessage.in | \
  sed -e '/^Message-Id:/d' -e '/^Date:/d' -e '/^From:/d' >testmessage.out
  cmp testmessage.in testmessage.out
}

for k in 1 2 4 8 10 20 40 80 100; do
  echo "Testing inject with ${k}KB of uuencoded data"
  tst $k
done

rm -f testmessage.{in,out}
